function updateUserLayer(t){$userLayer.length&&"undefined"==typeof $blackFriday?$.ajax({url:Routing.generate("pcc_web_user_ajax"),dataType:"HTML",method:"GET",cache:!1,success:function(e){if(t){var i=$("<div></div>").html(e),a=i.find(".js-units").text(),r=i.find("#pccom-basket").children();$carritoHeader.find(".js-units").text(a),checkIfDeviceIsWindows()?document.querySelector("#pccom-basket").innerHTML=r.html():($pcComBasket.html(r),$pcComBasket.siblings("script").replaceWith(i.find("script"))),closeCart()}else $userLayer.html(e),PccUserId.save();$(".js-user-menu-link").on("click",function(t){$(window).width()<768&&t.preventDefault()})}}):$(".input-units").length&&$(".input-units").trigger("change")}function closeCart(){function t(t){t||(t=2e3),cartTimeout=setTimeout(function(){$carritoHeader.parent().removeClass("is-active")},t)}$carritoHeader=$(".js-user-cart"),($pcComBasket=$("#pccom-basket")).on("mouseenter",function(){clearTimeout(cartTimeout)}).on("mouseleave",function(){t(500)}),t()}function getCleanedString(t){for(var e=0;e<"!@#$^&%*()+=-[]{}|:<>?,.".length;e++)t=t.replace(new RegExp("\\"+"!@#$^&%*()+=-[]{}|:<>?,."[e],"gi"),"");return t=t.toLowerCase(),t=t.replace(/ /g,"_"),t=t.replace(/[/]/g,"_"),t=t.replace(/á/gi,"a"),t=t.replace(/é/gi,"e"),t=t.replace(/í/gi,"i"),t=t.replace(/ó/gi,"o"),t=t.replace(/ú/gi,"u"),t=t.replace(/ñ/gi,"n")}function confirmArticle(t,e){if(t.length){var i={idArticle:t.join(",")};$.ajax({url:Routing.generate("pcc_articles_confirm_availiability"),data:i,dataType:"json",method:"get",async:!1,success:function(t){"function"==typeof e&&e(t)},error:function(t){}})}else console.error("You must supply an array of ids")}function checkIfDeviceIsWindows(){return!!(window.navigator.userAgent.indexOf("MSIE ")>0||navigator.userAgent.match(/Trident.*rv\:11\./))}var $userLayer=$(".js-user-menu"),$carritoHeader=$(".js-user-cart").parent(),$pcComBasket=$("#pccom-basket"),cartTimeout;!function(t){function e(){/iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream&&t(".js-header-sep, .js-back-button").addClass("is-visible"),t(".js-back-button").on("click",function(){window.history.back()})}var i=i||{};i.ListenerLoader=function(){this.idCont=0,this.listeners=[]},i.ListenerLoader.prototype.get=function(t){if(t.is("["+i.options.attr_id_listener+"]"))return this.listeners[t.attr(i.options.attr_id_listener)];var e=new i.Listener(t);return t.attr(i.options.attr_id_listener,this.idCont),this.listeners[this.idCont++]=e,e};var a=new i.ListenerLoader;i.options={attr_trigger:"data-pcc-trigger",attr_event:"data-pcc-event",attr_group:"data-pcc-group",attr_listener:"data-pcc-listen",attr_class:"data-pcc-class",attr_active_init:"data-pcc-active",attr_id_listener:"data-pcc-id-listener",attr_after:"data-pcc-after"},i.Observer=function(t){this.observer=t,this.name=this.observer.attr(i.options.attr_trigger),this.group=this.observer.attr(i.options.attr_group),this.loadListeners(),this.loadGroups(),this.loadEvent()},i.Observer.prototype.loadGroups=function(){if(this.groups=[],this.group){var e=this;t("*["+i.options.attr_group+"="+this.group+"]["+i.options.attr_listener+"]["+i.options.attr_listener+"!="+this.name+"]").each(function(){e.groups.push(a.get(t(this)))})}},i.Observer.prototype.loadListeners=function(){this.listeners=[];var e=this;t("*["+i.options.attr_listener+"="+this.name+"]["+i.options.attr_class+"]").each(function(){var i=t(this),r=a.get(i);e.listeners.push(r),jQuery.data(i,"listener",r)})},i.Observer.prototype.loadEvent=function(){var t=this;switch(this.observer.attr(i.options.attr_event)){case"hover":this.observer.on("mouseenter",function(){t.notify()}).on("mouseleave",function(){t.notify()});break;case"checked":this.observer.on("change",function(){t.notify()});break;case"click":default:this.observer.on("click",function(){t.notify()})}},i.Observer.prototype.notify=function(){for(var t=0,e=this.groups.length;t<e;t++)this.groups[t].reset();for(var t=0,e=this.listeners.length;t<e;t++)this.listeners[t].notify()},i.Listener=function(t){this.listener=t,this.class_name=this.listener.attr(i.options.attr_class),this.group=this.listener.attr(i.options.attr_group),this.initial_active=this.listener.is("["+i.options.attr_active_init+"]")?"1"==this.listener.attr(i.options.attr_active_init):this.listener.hasClass(this.class_name),this.current_active=this.listener.hasClass(this.class_name),this.after=this.listener.attr(i.options.attr_after)},i.Listener.prototype.notify=function(){this.current_active?(this.listener.removeClass(this.class_name),this.current_active=!1):(this.listener.addClass(this.class_name),this.current_active=!0),this.after&&this.listener.trigger(this.after)},i.Listener.prototype.reset=function(){this.initial_active?(this.listener.addClass(this.class_name),this.current_active=!0):(this.listener.removeClass(this.class_name),this.current_active=!1)},t(function(){var e=[];t("*["+i.options.attr_trigger+"]").each(function(){var a=new i.Observer(t(this));e.push(a)})});var r=t(".owl-carousel");t("#menu-principal").hover(function(){r.clearQueue().addClass("off-focus-slider")},function(){r.delay(400).queue(function(e){t(this).removeClass("off-focus-slider")})}),t("body").on("click",".btn-add-cart",function(e){var i=t(this),a=Routing.generate("pcc_cart_add_item_ajax",{idArticle:i.data("id")}),r={units:1,warranty:0};i.data("offer")&&(r.idOffer=i.data("offer")),$carritoHeader=t(".js-user-cart"),$pcComBasket=t("#pccom-basket"),i.attr("disabled",!0),i.stateButton("loading"),$carritoHeader.parent().addClass("is-active"),clearTimeout(cartTimeout);var s=t("<div></div>").html(t("#ajax-loadin-container").html());if(s.find(".overlay-spin").css({top:0,position:"static"}).find(".spinner").css({margin:"0 auto 10px","box-shadow":"none"}),$pcComBasket.prepend(t("<li></li>").append(s).append(t("<hr/>"))),t.post(a,r,function(t){i.stateButton("reset"),updateUserLayer(!0)}).always(function(){i.removeAttr("disabled")}),window.dataLayer=window.dataLayer||[],dataLayer.push({event:"addToCart",ecommerce:{currencyCode:"EUR",add:{products:[{name:t(this).data("name"),id:t(this).data("id"),price:t(this).data("price"),brand:t(this).data("brand"),category:t(this).data("category"),quantity:t(this).data("qty")}]}},user:PccUserId.get()}),PCC.loadCometHunter){var n=Routing.generate("pcc_web_comethunter"),o={event:"addToCart",quantity:t(this).data("qty"),id_item:t(this).data("id"),price:t(this).data("price"),brand:t(this).data("brand"),category:t(this).data("category"),name:t(this).data("name")};t.post(n,o,function(t){}),window._vteq=window._vteq||[],window._vteq.push({addtocart:{itemId:t(this).data("id")}})}}),t(window).resize(function(){t(window).width()>991&&t(".superfamilia--desplegada").removeClass("superfamilia--desplegada")}),t(document).ready(function(){updateUserLayer(),e()})}(jQuery);
